<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexagonal Grid</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding-bottom: 20px; /* Added padding at the bottom of the page */
            background-color: #fff; /* Changed background color to white */
            font-family: 'Arial', sans-serif;
        }

        .controls {
            margin-top: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .input-row {
            display: flex;
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label {
            margin-bottom: 5px;
        }

        input[type="number"] {
            width: 80px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        button {
            padding: 8px 50px; /* Adjusted padding for wider and shorter buttons */
            font-size: 16px;
            border: 1px solid #000; /* Increased border width to 2px */
            border-radius: 10px;
            background-color: #fff;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #000;
            color: #fff;
        }

        .grid-container {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            width: 100%;
            height: 100%;
        }

        .grid {
            display: grid;
            gap: 0;
            position: relative;
        }

        .hex {
            background-color: #ccc;
            clip-path: polygon(
                25% 0%, 75% 0%, 100% 50%, 
                75% 100%, 25% 100%, 0% 50%
            );
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .hex:hover {
            background-color: #aaa;
        }

        #download-cells {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <div class="input-row">
            <div class="input-group">
                <label for="rows">Rows:</label>
                <input type="number" id="rows" value="20" min="1">
            </div>
            <div class="input-group">
                <label for="columns">Columns:</label>
                <input type="number" id="columns" value="100" min="1">
            </div>
        </div>
        <button id="generate-grid">Generate Grid</button>
    </div>
    <div class="grid-container">
        <div class="grid"></div>
    </div>
    <button id="download-cells" style="display: none;">Download Cells</button>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.querySelector('.grid');
            const generateGridButton = document.getElementById('generate-grid');
            const downloadCellsButton = document.getElementById('download-cells');
            const rowsInput = document.getElementById('rows');
            const columnsInput = document.getElementById('columns');

            let isMouseDown = false;
            let startHex = null;

            const setHexagonColor = (hex) => {
                hex.style.backgroundColor = 'red';
            };

            const clearHexagonColor = (hex) => {
                hex.style.backgroundColor = '#ccc';
            };

            const getHexPosition = (hex) => {
                return { row: parseInt(hex.dataset.row), col: parseInt(hex.dataset.col) };
            };

            const colorHexagonsInRectangle = (start, end) => {
                const [startRow, endRow] = [start.row, end.row].sort((a, b) => a - b);
                const [startCol, endCol] = [start.col, end.col].sort((a, b) => a - b);

                for (let row = startRow; row <= endRow; row++) {
                    for (let col = startCol; col <= endCol; col++) {
                        const hex = document.querySelector(`.hex[data-row='${row}'][data-col='${col}']`);
                        setHexagonColor(hex);
                    }
                }
            };

            generateGridButton.addEventListener('click', () => {
                const rows = parseInt(rowsInput.value);
                const columns = parseInt(columnsInput.value);

                // Calculate hexagon width and height based on the number of rows and columns
                const hexWidth = Math.min(window.innerWidth / (columns + 1), window.innerHeight / (rows * Math.sqrt(3) / 2 + 1));
                const hexHeight = hexWidth * Math.sqrt(3) / 2;
                const hexTransformY = hexHeight * 0.65; // 0.65 times the height of the hexagon
                const rowGap = hexHeight * 0.3; // 30% of the height for gap

                // Clear existing grid
                grid.innerHTML = '';

                // Update grid template columns and rows
                grid.style.gridTemplateColumns = `repeat(${columns}, ${hexWidth}px)`;
                grid.style.gridTemplateRows = `repeat(${rows}, ${hexHeight + rowGap}px)`; 

                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < columns; col++) {
                        const hex = document.createElement('div');
                        hex.classList.add('hex');
                        hex.style.width = `${hexWidth}px`;
                        hex.style.height = `${hexHeight}px`;
                        hex.style.gridColumn = col + 1;
                        hex.style.gridRow = row + 1;
                        hex.dataset.row = row;
                        hex.dataset.col = col;
                        if (col % 2 !== 0) {
                            hex.style.transform = `translateY(${hexTransformY}px)`; /* 0.65 times the height of the hexagon */
                        }

                        hex.addEventListener('mousedown', (e) => {
                            isMouseDown = true;
                            startHex = getHexPosition(hex);
                            if (e.ctrlKey || e.metaKey) {
                                // Ctrl or Command key pressed, clear the color
                                clearHexagonColor(hex);
                            } else {
                                setHexagonColor(hex);
                            }
                        });

                        hex.addEventListener('mousemove', (e) => {
                            if (isMouseDown && startHex) {
                                const currentHex = getHexPosition(hex);
                                colorHexagonsInRectangle(startHex, currentHex);
                            }
                        });

                        hex.addEventListener('click', (e) => {
                            if (!isMouseDown) {
                                if (e.ctrlKey || e.metaKey) {
                                    // Ctrl or Command key pressed, clear the color
                                    clearHexagonColor(hex);
                                } else {
                                    setHexagonColor(hex);
                                }
                            }
                        });

                        grid.appendChild(hex);
                    }
                }

                // Show the download cells button
                downloadCellsButton.style.display = 'block';
            });

            document.addEventListener('mouseup', () => {
                isMouseDown = false;
                startHex = null;
            });

            downloadCellsButton.addEventListener('click', () => {
                const rows = parseInt(rowsInput.value); // Get the number of rows
                const hexagons = document.querySelectorAll('.hex');
                const coloredHexagons = [];
                hexagons.forEach(hex => {
                    if (hex.style.backgroundColor === 'red') {
                        // Calculate the coordinates according to the new requirements
                        const x = parseInt(hex.dataset.col);
                        const y = rows - parseInt(hex.dataset.row) - 1; // Subtract 1 to make it 0-based
                        coloredHexagons.push(`(${x}, ${y})`);
                    }
                });
                const blob = new Blob([coloredHexagons.join(', ')], { type: 'text/plain' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'colored_hexagons.txt';
                a.click();
            });
        });
    </script>
</body>
</html>
